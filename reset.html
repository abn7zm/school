<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تعيين كلمة مرور جديدة</title>

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}

body{
  font-family:Tajawal,sans-serif;
  background:#eceeef; /* أغمق شوي */
  margin:0;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#333
}

.center-box{
  background:#fff;
  width:100%;
  max-width:480px; /* أكبر */
  padding:44px 40px;
  border-radius:18px;
  border:1px solid #e2e2e2;
  box-shadow:0 12px 30px rgba(0,0,0,.08)
}

h2{
  text-align:center;
  font-size:22px;
  margin:0 0 8px;
  font-weight:600;
  color:#333
}

.subtitle{
  text-align:center;
  font-size:14px;
  color:#777;
  margin-bottom:30px
}

input{
  width:100%;
  padding:15px;
  margin-top:16px;
  font-size:15px;
  border-radius:12px;
  border:1px solid #dcdcdc;
  background:#fafafa;
  transition:.2s
}

input:focus{
  outline:none;
  background:#fff;
  border-color:#005d7e
}

button{
  margin-top:32px;
  width:100%;
  padding:16px;
  border:none;
  border-radius:30px;
  background:#005d7e; /* الأزرق السابق */
  color:#fff;
  font-size:17px;
  cursor:pointer;
  transition:.25s
}

button:hover{
  background:#00445c
}

.success{
  display:none;
  margin-top:24px;
  padding:14px;
  border-radius:12px;
  background:#f0f7f2;
  color:#2f6b3f;
  text-align:center;
  font-size:15px
}

.error{
  display:none;
  margin-top:24px;
  padding:14px;
  border-radius:12px;
  background:#fbf1f1;
  color:#9c2f2f;
  text-align:center;
  font-size:15px
}

.timer{
  margin-top:8px;
  font-size:13px;
  color:#666
}
</style>
</head>

<body>

<div class="center-box">
  <h2>تعيين كلمة مرور جديدة</h2>
  <div class="subtitle">يرجى إدخال كلمة مرور جديدة وتأكيدها</div>

  <input id="pass1" type="password" placeholder="كلمة المرور الجديدة">
  <input id="pass2" type="password" placeholder="تأكيد كلمة المرور">

  <button onclick="reset()">حفظ كلمة المرور</button>

  <div class="success" id="ok">
    تم تغيير كلمة المرور بنجاح ✔
    <div class="timer" id="countdown"></div>
  </div>

  <div class="error" id="err"></div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyud8NS18rOn7W1YngyRv4cuCFjvnBMQi-gwH_tUsfzIZpKcOENZ6ekH_wINN4wSu-78Q/exec";
const token = new URLSearchParams(location.search).get("token");

async function reset(){
  err.style.display="none";

  if(pass1.value !== pass2.value){
    err.textContent="كلمتا المرور غير متطابقتين";
    err.style.display="block";
    return;
  }

  const data = new URLSearchParams();
  data.append("action","resetPassword");
  data.append("token",token);
  data.append("newpass",pass1.value);

  const res = await fetch(SCRIPT_URL,{method:"POST",body:data});
  const t = await res.text();

  if(t === "done"){
    ok.style.display="block";

    let s = 5;
    countdown.textContent = `سيتم تحويلك خلال ${s} ثواني`;

    const i = setInterval(()=>{
      s--;
      countdown.textContent = `سيتم تحويلك خلال ${s} ثواني`;
      if(s === 0){
        clearInterval(i);
        location.href = "index.html";
      }
    },1000);

  }else{
    err.textContent="الرابط غير صالح أو منتهي";
    err.style.display="block";
  }
}
</script>

</body>
</html>
