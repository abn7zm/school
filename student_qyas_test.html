<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
* {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background-color: #f0f0f0;
      text-align: center;
      padding: 0;
      min-height: 100vh;
      display:flex;
      flex-direction: column;
      direction: rtl;
    }
header {
      background-color: #005d7e;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    header img {
      height: 120px;
      filter: drop-shadow(0 0 10px #00e6f6);
    }

    .return-home-button {
      background-color: #f6b100;
      color: #ffffff;
      padding: 10px 20px;
      border-radius: 5px;
      text-decoration: none;
      font-weight: bold;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .return-home-button:hover {
      background-color: #c48d01;
      color: white;
    }

    h1 {
      text-align: center;
      margin: 40px 0 20px;
      color: #333;
      font-size: 36px;
    }
    
/* cards */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:20px;
  padding:20px
}
.test-card{
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 6px 15px rgba(0,0,0,.1);
  background:#fff;
  transition:.3s;
  position:relative;
}
.test-card:hover{
  transform:translateY(-5px)
}
.card-top{
  background:#005d7e;
  color:#fff;
  height:120px;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  font-size:18px;
  font-weight:bold;
  padding:10px;
  cursor:pointer
}
.card-bottom{
  display:flex;
  justify-content:space-between;
  padding:12px 15px;
  align-items:center
}
.type{
  font-weight:bold
}
.level{
  padding:5px 12px;
  border-radius:20px;
  color:#fff;
  font-size:13px
}
.easy{background:green}
.medium{background:orange}
.hard{background:red}

/* last score */
.last-score{
  padding:5px 15px;
  font-size:14px;
  color:#333;
}

/* spinner */
.spinner-container{
  text-align:center;
  padding:40px
}
.spinner{
  width:40px;
  height:40px;
  border:4px solid #ddd;
  border-top:4px solid #005d7e;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:0 auto 10px
}

/* score modal */
#scoreModal{
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.5);
  z-index:9999;
  justify-content:center;
  align-items:center;
}
#scoreBox{
  background:#fff;
  padding:20px;
  border-radius:10px;
  max-width:300px;
  width:90%;
  text-align:center;
}
#scoreBox input, #scoreBox select{
  width:100%;
  padding:8px;
  margin-top:10px;
}
#scoreBox button{
  margin-top:10px;
  width:100%;
  padding:8px;
  background:#28a745;
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer
}
.footer {
      background-color: #005d7e;
      color: #ffffff;
      padding: 25px 40px;
      width: 100%;
      text-align: right;
      margin-top: auto;
      box-sizing: border-box;
    }

    .footer h3 {
      margin-bottom: 15px;
      font-size: 22px;
      color: #ffffff;
      font-weight: bold;
      border-bottom: 2px solid #f6b100;
      padding-bottom: 5px;
    }

    .contact-list {
      list-style: none;
      padding: 0;
      margin: 0 0 20px 0;
      font-size: 18px;
    }

    .contact-list li {
      margin-bottom: 10px;
    }

    .contact-list li a {
      color: #ffffff;
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .contact-list li a:hover {
      color: #007a8c;
      text-decoration: underline;
    }
    .end {
      text-align: center;
      color: #ffffff;
      font-size: 14px;
      margin-top: 15px;
    }

    a {
      text-decoration: none;
    }
</style>
</head>

<body>

<header>
  <a href="#" onclick="window.history.back();" class="return-home-button">Ø§Ù„Ø¹ÙˆØ¯Ø©</a>
  <h1 style="color: #ffffff; position: relative; right: 30px;">Ø§Ù„Ø¥Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</h1>
  <img src="https://i.postimg.cc/Y0YGqTrW/logo1.png" alt="logo">

  </header>

<div id="loading" class="spinner-container">
  <div class="spinner"></div>
  <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª...</p>
</div>

<div id="cardsContainer" class="cards"></div>

<!-- Score Modal -->
<div id="scoreModal">
  <div id="scoreBox">
    <h3>Ø£Ø¯Ø®Ù„ Ø¯Ø±Ø¬ØªÙƒ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
   <input type="number" min="0" id="scoreInput" placeholder="Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ØªÙŠ Ø­ØµÙ„Øª Ø¹Ù„ÙŠÙ‡Ø§">
<p id="scoreMaxText" style="margin-top:10px;">Ù…Ù† Ø£ØµÙ„ 0</p>

    <button id="saveScoreBtn">Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø¬Ø©</button>
  </div>
</div>
<div class="footer">
    <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</h3>
    <ul class="contact-list">
      <li>ğŸ“ <a href="tel:+966536382599">+966 536382599</a></li>
      <li>ğŸ“§ <a href="mailto:abn7zm@gmail.com">abn7zm@gmail.com</a></li>
      <li>ğŸ« Ù…Ø¬Ù…Ø¹ Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ø¨Ù† Ø­Ø²Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ, ØªØ¨ÙˆÙƒ</li>
    </ul>
    <p class="end">Â©2023-<span id="year"></span> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ø§Ù„ÙÙƒØ±ÙŠØ© ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚ÙŠØ© Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø§Ø³Ù… Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ø¨Ù† Ø­Ø²Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</p>
  </div>
<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxw2vzEv0X1A9reYmnlm5hJzqPUHAs-swEefQTerhLYNyHICztUwv24GG_hwUBOdaQ_rA/exec"; // Ø¶Ø¹ Ø±Ø§Ø¨Ø· Google Apps Script Ù‡Ù†Ø§
const studentName = localStorage.getItem("userName") || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
let currentTestTitle = null;
let currentCard = null;

// --- ØªØ¹ÙŠÙŠÙ† Ù„ÙˆÙ† Ø§Ù„ØµØ¹ÙˆØ¨Ø© ---
function levelClass(l){
  if(l==="Ø³Ù‡Ù„") return "easy";
  if(l==="Ù…ØªÙˆØ³Ø·") return "medium";
  return "hard";
}

// --- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ---
function loadTests(){
  loading.style.display="block";
  cardsContainer.innerHTML="";

  fetch(API_URL)
    .then(r=>r.json())
    .then(data=>{
      loading.style.display="none";

      if(data.length===0){
        cardsContainer.innerHTML="<p style='text-align:center'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>";
        return;
      }

      data.forEach(t=>{
        const card = document.createElement("div");
        card.className="test-card";
        card.innerHTML=`
          <div class="card-top">${t.title}</div>
          <div class="card-bottom">
            <div class="type">${t.type}</div>
            <div class="level ${levelClass(t.level)}">${t.level}</div>
          </div>
          <div class="last-score" id="lastScore_${t.title.replace(/\s+/g,'_')}">
            Ø¢Ø®Ø± Ø¯Ø±Ø¬Ø©: - 
          </div>
        `;

        // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
       // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
card.querySelector(".card-top").addEventListener("click", ()=>{
  currentTestTitle = t.title;
  currentCard = card;
  currentTestMaxScore = t.maxScore; // <-- Ø®Ø²Ù†Ù†Ø§ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù‚ØµÙˆÙ‰
  window.open(t.link,"_blank");
  showScoreModal();
});


        cardsContainer.appendChild(card);
      });

      // Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§ØªØŒ Ù†Ø¬Ù„Ø¨ Ø¢Ø®Ø± Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ù† Ø§Ù„Ø´ÙŠØª
      showLastScores();
    })
    .catch(()=>{loading.innerHTML="âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";});
}

// --- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø© ---
function showScoreModal(){
  document.getElementById("scoreMaxText").innerText = "Ù…Ù† Ø£ØµÙ„ " + currentTestMaxScore;
  document.getElementById("scoreModal").style.display="flex";
}

function hideScoreModal(){document.getElementById("scoreModal").style.display="none";}

// Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø¬Ø©
document.getElementById("saveScoreBtn").addEventListener("click", ()=>{
  const scoreInput = document.getElementById("scoreInput");
  const score = Number(scoreInput.value); // Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ØªÙŠ Ø£Ø¯Ø®Ù„Ù‡Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨

  // ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¯Ø±Ø¬Ø© Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù‚ØµÙˆÙ‰
  if(score === "" || score < 0 || score > currentTestMaxScore){
    alert(`ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¯Ø±Ø¬Ø© ØµØ­ÙŠØ­Ø© Ù…Ù† 0 Ø¥Ù„Ù‰ ${currentTestMaxScore}`);
    return;
  }

  const fd = new FormData();
  fd.append("action","saveScore");
  fd.append("student", studentName);
  fd.append("test", currentTestTitle);
  fd.append("score", score + " Ù…Ù† " + currentTestMaxScore);

  fetch(API_URL,{method:"POST",body:fd})
    .then(()=>{
      alert("âœ… ØªÙ… Ø­ÙØ¸ Ø¯Ø±Ø¬ØªÙƒ");
      scoreInput.value="";
      hideScoreModal();
      updateLastScore(currentTestTitle, score + " Ù…Ù† " + currentTestMaxScore);
    });
});

// --- Ø¬Ù„Ø¨ Ø¢Ø®Ø± Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ---
function showLastScores(){
  fetch(API_URL + "?action=getScores")
    .then(r=>r.json())
    .then(scores=>{
      scores.forEach(s=>{
        if(s.student === studentName){
          const id = "lastScore_" + s.test.replace(/\s+/g,'_');
          const el = document.getElementById(id);
          if(el) el.innerText = "Ø¢Ø®Ø± Ø¯Ø±Ø¬Ø©: " + s.score;
        }
      });
    });
}

// --- ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± Ø¯Ø±Ø¬Ø© ØªØ­Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ---
function updateLastScore(testTitle, scoreText){
  const id = "lastScore_" + testTitle.replace(/\s+/g,'_');
  const el = document.getElementById(id);
  if(el) el.innerText = "Ø¢Ø®Ø± Ø¯Ø±Ø¬Ø©: " + scoreText;
}

// Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
loadTests();
</script>

</body>
</html>