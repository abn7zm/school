<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
* {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background-color: #f0f0f0;
      text-align: center;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      direction: rtl;
    }

    header {
      background-color: #005d7e;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    header img {
      height: 120px;
      filter: drop-shadow(0 0 10px #00e6f6);
    }

    .return-home-button {
      background-color: #f6b100;
      color: #ffffff;
      padding: 10px 20px;
      border-radius: 5px;
      text-decoration: none;
      font-weight: bold;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .return-home-button:hover {
      background-color: #c48d01;
      color: white;
    }

    h1 {
      text-align: center;
      margin: 40px 0 20px;
      color: #333;
      font-size: 36px;
    }


/* cards */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:20px;
  padding:20px
}
.test-card{
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 6px 15px rgba(0,0,0,.1);
  background:#fff;
  transition:.3s
}
.test-card:hover{
  transform:translateY(-5px)
}
.card-top{
  background:#005d7e;
  color:#fff;
  height:120px;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  font-size:18px;
  font-weight:bold;
  padding:10px;
  cursor:pointer
}
.card-bottom{
  display:flex;
  justify-content:flex-end;
  padding:12px 15px;
  align-items:center
}
.type{font-weight:bold}

/* top 5 list */
.top-list{
  padding:10px 15px;
  border-top:1px solid #eee;
  background:#f9f9f9;
}
.top-list h4{
  margin:0 0 5px 0;
  font-size:14px;
  color:#333;
}
.top-list ul{
  list-style:none;
  padding:0;
  margin:0;
}
.top-list li{
  padding:3px 0;
  font-size:13px;
}

/* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø±Ø§ØªØ¨ */
.rank-1{color:#FFD700;font-weight:bold;} /* Ø°Ù‡Ø¨ÙŠ */
.rank-2{color:#C0C0C0;font-weight:bold;} /* ÙØ¶ÙŠ */
.rank-3{color:#CD7F32;font-weight:bold;} /* Ø¨Ø±ÙˆÙ†Ø²ÙŠ */

/* spinner */
.spinner-container{
  text-align:center;
  padding:40px
}
.spinner{
  width:40px;
  height:40px;
  border:4px solid #ddd;
  border-top:4px solid #005d7e;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:0 auto 10px
}
@keyframes spin{
  to{transform:rotate(360deg)}
}
.footer {
      background-color: #005d7e;
      color: #ffffff;
      padding: 25px 40px;
      width: 100%;
      text-align: right;
      margin-top: auto;
      box-sizing: border-box;
    }

    .footer h3 {
      margin-bottom: 15px;
      font-size: 22px;
      color: #ffffff;
      font-weight: bold;
      border-bottom: 2px solid #f6b100;
      padding-bottom: 5px;
    }

    .contact-list {
      list-style: none;
      padding: 0;
      margin: 0 0 20px 0;
      font-size: 18px;
    }

    .contact-list li {
      margin-bottom: 10px;
    }

    .contact-list li a {
      color: #ffffff;
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .contact-list li a:hover {
      color: #007a8c;
      text-decoration: underline;
    }

    .end {
      text-align: center;
      color: #ffffff;
      font-size: 14px;
      margin-top: 15px;
    }

    a {
      text-decoration: none;
    }
</style>
</head>

<body>

<header>
    <a href="#" onclick="window.history.back();" class="return-home-button">Ø§Ù„Ø¹ÙˆØ¯Ø©</a>
    <h1 style="color: #ffffff; position: relative; right: 30px;">ØªØ±ØªÙŠØ¨ Ø§Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø§Ø¨</h1>
    <img src="https://i.postimg.cc/Y0YGqTrW/logo1.png" alt="logo">

  </header>
<div id="loading" class="spinner-container">
  <div class="spinner"></div>
  <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
</div>

<div id="cardsContainer" class="cards"></div>
<div class="footer">
    <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</h3>
    <ul class="contact-list">
      <li>ğŸ“ <a href="tel:+966536382599">+966 536382599</a></li>
      <li>ğŸ“§ <a href="mailto:abn7zm@gmail.com">abn7zm@gmail.com</a></li>
      <li>ğŸ« Ù…Ø¬Ù…Ø¹ Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ø¨Ù† Ø­Ø²Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ, ØªØ¨ÙˆÙƒ</li>
    </ul>
    <p class="end">Â©2023-<span id="year"></span> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ø§Ù„ÙÙƒØ±ÙŠØ© ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚ÙŠØ© Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø§Ø³Ù… Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ø¨Ù† Ø­Ø²Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</p>
  </div>
<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxw2vzEv0X1A9reYmnlm5hJzqPUHAs-swEefQTerhLYNyHICztUwv24GG_hwUBOdaQ_rA/exec"; // Ø±Ø§Ø¨Ø· Google Script Ø§Ù„Ø­Ø§Ù„ÙŠ

function loadRanking(){
  const loading = document.getElementById("loading");
  const cardsContainer = document.getElementById("cardsContainer");
  loading.style.display = "block";
  cardsContainer.innerHTML = "";

  fetch(API_URL)
    .then(r=>r.json())
    .then(tests=>{
      fetch(API_URL+"?action=getScores")
        .then(r=>r.json())
        .then(scores=>{
          loading.style.display = "none";

          if(tests.length === 0){
            cardsContainer.innerHTML="<p style='text-align:center'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</p>";
            return;
          }

          tests.forEach(test=>{
            const card = document.createElement("div");
            card.className = "test-card";
            card.innerHTML = `
              <div class="card-top">${test.title}</div>
              <div class="card-bottom">
                <div class="type">${test.type}</div>
              </div>
              <div class="top-list">
                <h4>Ø£Ø¹Ù„Ù‰ 5 Ø·Ù„Ø§Ø¨:</h4>
                <ul id="topList_${test.title.replace(/\s+/g,'_')}">
                  <li>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</li>
                </ul>
              </div>
            `;
            cardsContainer.appendChild(card);

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ù„ÙƒÙ„ Ø§Ø®ØªØ¨Ø§Ø±
            const testScores = scores
              .filter(s=>s.test===test.title)
              .map(s=>{
                const parts = s.score.split(" Ù…Ù† ");
                const scoreNum = parseFloat(parts[0]) || 0;
                return {student: s.student, score: scoreNum};
              });

            // Ø£Ø¹Ù„Ù‰ Ø¯Ø±Ø¬Ø© Ù„ÙƒÙ„ Ø·Ø§Ù„Ø¨ ÙÙ‚Ø·
            const highestPerStudent = {};
            testScores.forEach(s=>{
              if(!highestPerStudent[s.student] || s.score > highestPerStudent[s.student]){
                highestPerStudent[s.student] = s.score;
              }
            });

            const sorted = Object.entries(highestPerStudent)
              .map(([student, score])=>({student, score}))
              .sort((a,b)=>b.score - a.score)
              .slice(0,5);

            const ul = document.getElementById("topList_"+test.title.replace(/\s+/g,'_'));
            ul.innerHTML = "";
            if(sorted.length===0){
              ul.innerHTML="<li>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯Ø±Ø¬Ø§Øª</li>";
            } else {
              sorted.forEach((s,i)=>{
                let rankClass = "";
                if(i===0) rankClass="rank-1";
                else if(i===1) rankClass="rank-2";
                else if(i===2) rankClass="rank-3";
                ul.innerHTML += `<li class="${rankClass}">${i+1}. ${s.student} - ${s.score}</li>`;
              });
            }
          });
        });
    })
    .catch(()=>{
      document.getElementById("loading").innerHTML="âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
    });
}

loadRanking();
</script>

</body>
</html>
